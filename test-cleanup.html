<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ cleanupWebBookings</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #00A86B;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #008855;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ –û—á–∏—Å—Ç–∫–∞ –≤–µ–±-–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é cleanupWebBookings –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.</p>
        
        <div>
            <button id="loginBtn" onclick="login()">1. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            <button id="callBtn" onclick="callCleanup()" disabled>2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É</button>
        </div>
        
        <div id="status" class="status info" style="display:none;"></div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAnp3SY9XEyF-le5q_Tcv-7Le2qqvtz0ZM",
            authDomain: "sports-booking-app-1d7e5.firebaseapp.com",
            databaseURL: "https://sports-booking-app-1d7e5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "sports-booking-app-1d7e5",
            storageBucket: "sports-booking-app-1d7e5.firebasestorage.app",
            messagingSenderId: "648540980109",
            appId: "1:648540980109:web:97fbe182c59bb2641ab3c4",
            measurementId: "G-VL4MCP1PZP"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const functions = firebase.functions('europe-west1');
        
        let currentUser = null;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        auth.onAuthStateChanged(user => {
            currentUser = user;
            updateUI();
        });

        function updateUI() {
            const loginBtn = document.getElementById('loginBtn');
            const callBtn = document.getElementById('callBtn');
            
            if (currentUser) {
                loginBtn.textContent = `‚úÖ –í–æ—à–ª–∏ –∫–∞–∫: ${currentUser.email}`;
                loginBtn.disabled = true;
                callBtn.disabled = false;
                callBtn.style.opacity = '1';
                callBtn.style.cursor = 'pointer';
                showStatus(`–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ${currentUser.email}\n–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É.`, 'success');
            } else {
                loginBtn.textContent = '1. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                loginBtn.disabled = false;
                callBtn.disabled = true;
                callBtn.style.opacity = '0.5';
                callBtn.style.cursor = 'not-allowed';
            }
        }

        async function login() {
            showStatus('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...', 'loading');
            
            const email = prompt('Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:');
            if (!email) return;
            
            const password = prompt('–ü–∞—Ä–æ–ª—å:');
            if (!password) return;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showStatus(`–£—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –∫–∞–∫ ${email}`, 'success');
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
                setTimeout(() => {
                    updateUI();
                }, 500);
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}`, 'error');
            }
        }

        async function callCleanup() {
            if (!currentUser) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            
            showStatus('üîÑ –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ cleanupWebBookings...', 'loading');
            
            try {
                const cleanupWebBookings = functions.httpsCallable('cleanupWebBookings');
                const result = await cleanupWebBookings({});
                
                if (result.data.success) {
                    showStatus(`‚úÖ –£—Å–ø–µ—à–Ω–æ!\n\n–£–¥–∞–ª–µ–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${result.data.deletedBookings}\n–£–¥–∞–ª–µ–Ω–æ –ø–ª–∞—Ç–µ–∂–µ–π: ${result.data.deletedPayments}\n\n${result.data.message}`, 'success');
                } else {
                    showStatus(`‚ùå –û—à–∏–±–∫–∞: ${result.data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}\n\n–î–µ—Ç–∞–ª–∏: ${JSON.stringify(error.details || {}, null, 2)}`, 'error');
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
        showStatus('–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.', 'info');
    </script>
</body>
</html>