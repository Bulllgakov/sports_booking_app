<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Инициализация шаблона SMS для оплаты</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <h1>Инициализация шаблона SMS для ссылки на оплату</h1>
    <div id="auth-section">
        <h2>Сначала войдите как администратор:</h2>
        <input type="email" id="email" placeholder="Email администратора" value="toocvetok@gmail.com">
        <input type="password" id="password" placeholder="Пароль">
        <button onclick="login()">Войти</button>
    </div>
    <div id="template-section" style="display: none;">
        <h2>Теперь можно инициализировать шаблон:</h2>
        <button onclick="initTemplate()">Инициализировать шаблон</button>
        <button onclick="logout()">Выйти</button>
    </div>
    <div id="result"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAnp3SY9XEyF-le5q_Tcv-7Le2qqvtz0ZM",
            authDomain: "sports-booking-app-1d7e5.firebaseapp.com",
            databaseURL: "https://sports-booking-app-1d7e5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "sports-booking-app-1d7e5",
            storageBucket: "sports-booking-app-1d7e5.firebasestorage.app",
            messagingSenderId: "648540980109",
            appId: "1:648540980109:web:97fbe182c59bb2641ab3c4",
            measurementId: "G-VL4MCP1PZP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('template-section').style.display = 'block';
                document.getElementById('result').innerHTML = '<p style="color: green;">Авторизован как: ' + user.email + '</p>';
            } else {
                document.getElementById('auth-section').style.display = 'block';
                document.getElementById('template-section').style.display = 'none';
            }
        });

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                resultDiv.innerHTML = '<p style="color: green;">✅ Успешная авторизация!</p>';
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: red;">❌ Ошибка авторизации: ' + error.message + '</p>';
            }
        }

        async function logout() {
            await auth.signOut();
            document.getElementById('result').innerHTML = '<p>Вы вышли из системы</p>';
        }

        async function initTemplate() {
            const resultDiv = document.getElementById('result');
            
            try {
                // Получаем текущие настройки
                const templatesDoc = await db.collection('settings').doc('smsTemplates').get();
                let templates = templatesDoc.exists ? templatesDoc.data() : {};
                
                // Добавляем шаблон paymentLink
                templates.paymentLink = {
                    enabled: true,
                    template: "Оплатите бронь по ссылке: {link}"
                };
                
                // Сохраняем обновленные настройки
                await db.collection('settings').doc('smsTemplates').set(templates, { merge: true });
                
                resultDiv.innerHTML = '<p style="color: green;">✅ Шаблон успешно инициализирован!</p>';
                
                // Проверяем сохранение
                const checkDoc = await db.collection('settings').doc('smsTemplates').get();
                const savedData = checkDoc.data();
                resultDiv.innerHTML += '<pre>' + JSON.stringify(savedData, null, 2) + '</pre>';
                
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: red;">❌ Ошибка: ' + error.message + '</p>';
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>