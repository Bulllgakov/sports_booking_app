# IP адреса для белого списка Т-Банка

## Webhook URL (NotificationURL)
```
https://allcourt.ru/api/webhooks/tbank-multiaccounts
```

## IP адреса Firebase Functions

Firebase Functions работают на инфраструктуре Google Cloud Platform и используют динамические IP адреса. 

### Варианты решения:

#### Вариант 1: Статический IP через Cloud NAT (РЕКОМЕНДУЕТСЯ)
Настроить статический IP адрес для исходящих запросов из Firebase Functions:

1. В Google Cloud Console перейти в VPC network → Cloud NAT
2. Создать NAT gateway с статическим IP
3. Настроить Cloud Functions для использования этого NAT

Преимущества:
- Один постоянный IP адрес
- Простое управление
- Надежность

#### Вариант 2: Диапазоны IP Google Cloud
Добавить диапазоны IP адресов Google Cloud для региона where Firebase Functions развернуты.

Для региона `us-central1` (по умолчанию):
```
# Основные диапазоны Google Cloud
35.185.0.0/16
35.186.0.0/16
35.187.0.0/16
35.188.0.0/16
35.189.0.0/16
35.190.0.0/16
35.191.0.0/16
35.192.0.0/14
35.196.0.0/14
35.200.0.0/14
35.204.0.0/14
35.208.0.0/14
35.212.0.0/14
35.216.0.0/14
35.220.0.0/14
35.224.0.0/14
35.228.0.0/14
35.232.0.0/14
35.236.0.0/14
35.240.0.0/14
35.244.0.0/14
```

#### Вариант 3: Использовать прокси-сервер
Настроить промежуточный сервер с статическим IP для проксирования запросов.

## Проверка текущего региона Firebase Functions

Выполните команду:
```bash
firebase functions:list
```

Регион будет указан в выводе. Обычно это `us-central1`.

## Рекомендации для Т-Банка

1. **Самый простой вариант для тестирования:**
   - Временно отключить проверку IP для тестового окружения
   - Или добавить широкие диапазоны Google Cloud

2. **Для продакшена:**
   - Настроить Cloud NAT со статическим IP
   - Сообщить этот IP в Т-Банк

## Контакты для уточнения

Если Т-Банк требует точные IP адреса, сообщите им, что:
1. Firebase Functions использует динамические IP из пула Google Cloud
2. Можно настроить статический IP через Cloud NAT (потребует дополнительной настройки)
3. NotificationURL (Webhook URL): `https://allcourt.ru/api/webhooks/tbank-multiaccounts`

## Альтернативное решение

Если Т-Банк не может работать с динамическими IP, можно:
1. Развернуть webhook handler на VPS со статическим IP
2. Использовать Cloud Run с настроенным статическим IP
3. Настроить Cloud NAT (требует платного аккаунта Google Cloud)